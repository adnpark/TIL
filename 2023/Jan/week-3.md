### Mon, Jan 16

- 알고리즘 강의를 이어서 들었다.
  - Time/Space Complexity 에 대한 개념을 다시 recap 할 수 있었다.
  - 다음 시간에는 Binary search에 대한 Complexity를 측정하는 방법을 배운다.
- RACE-13 오답노트를 작성했다.
  - Inline assembly에 대해 공부를 시작했다. 아마 이번주 주중 시간을 꾸준히 다 써야 하지 않을까 싶다.
  - 0x40은 free memory point라는것을 다시 한번 배웠다.
  - memory 주소와 사이즈가 헷갈리는데, 이 개념을 제대로 잡아야겠다.
- 사이드 프로젝트
  - 컨트랙트 작업을 시작했다. 상대적인 스테이킹 수량에 따라 다이나믹하게 컨텐츠 사이즈를 결정하는건 생각보다 어려울 것 같다. 고민하다가 안되면 그냥 고정된 값들로 단순화해서 작업을 진행하자.
  - 출금 기능을 간단하게 구현했다.
- 오퍼레이터 어카운트 잔액 부족 알람 봇
  - 대충 작업의 방향은 어느정도 나온것 같다. 아주 기초적인 코드들만 작업해뒀다.
  - 여전히 블랙박스인건 1) 어떻게 하면 slack bot으로 http message를 전송할 수 있는가 2) 어떻게 하면 Threshold 도달시 알람 횟수를 제한할 수 있을까이다.
  - 이 부분에 대해서 내일 고민해보자. 그리고 이 기회에 config를 다루는법도 익혀보면 좋겠다.

### Tue, Jan 17

- 오퍼레이터 어카운트 잔액 부족 알람 봇 작업
  - 다시 조금 헤매고 있다. 그래도 방향을 다시 잡았다.
  - alert, alarm, notification을 구분하기
  - 지금 내가 하려는것은 alert와 notification이다.
  - alert는 pagerDuty를 사용하자. 이걸 직접 구현하려면 DB도 써야돼서 좋지 않다.
  - notification은 indexer에 바로 구현하자. setInterval()을 활용해 볼 생각이다.
- 포스트모텀을 진행했다. 아래는 그 과정에서 배웠던것들 요약

  - RDB는 기본적으로 스케일이 힘들다. CAP를 싹 다 만족을 못한다. 블록체인 트릴레마 같은 느낌
    - C: Consistency - 데이터 요청시 가장 최신의 데이터 혹은 실패를 리턴한다. 여러 DB 노드에 동일한 쿼리를 날리면 동일한 응답이 와야 한다.
    - A: Availability - 모든 요청에 대해 정상적인 응답을 한다. (이건 liveness 랑 비슷?)
    - P: Partition Tolerance - 노드간의 통신 장애가 발생하더라도 동작해야 한다.
    - Network로 연결된 분산된 데이터베이스 시스템은 이 3가지 중 2가지만 충족할 수 있고, 모두를 충족할수는 없다.
  - 근데 다시 찾아보니까 RDB가 스케일하기가 힘들다는건 [RDB를 제대로 사용하지 못해서라는 의견](https://www.quora.com/Why-is-relational-database-difficult-to-scale)이 꽤 많이 보인다...
  - 근데 또 아닌것 같기도하고 ㅋㅋㅋ 뭐가 뭔지 모르겠다. [이 글](https://stackoverflow.com/questions/3423193/why-nosql-say-traditional-rdbms-is-not-good-at-scalable)도 참고해볼만 하다.
  - 스케일링이 horizontal과 vertical로 나뉘는것 같다.
  - RDB는 트래픽을 그러면 어떻게 버티는가?
    - master, slave 구성을 사용한다. master는 write용 DB, slave는 read 전용.
    - 쓰기 가능한 DB를 무턱대고 3대로 만들면 각 노드에 트랜잭션이 날라올 때, 서로간에 충돌이 생기면 조정을 어떻게 해야할지, 컨시스턴시 어떻게 유지하고 어떤 DB 인스턴스가 끊겼을 때 sync 복구 어떻게 할거냐 이런 문제들이 있다. 컨센서스랑 비슷한 느낌....이네
    - 그래서 대안으로 만든게 트래픽 구성을 보면 대부분의 워크로드들이 리드가 8이고 쓰기가 2다. 15:1일수도 있음
    - 왜냐면 DB write 하는 코드가 별로 없음. 거의 대부분의 앱들이 다 그럼
    - 그래서 slave를 만들어서 확장을 하자. master랑 주기적으로 sync만 한다. read replica라고 한다.
    - 얘네들은 4~50 ms sync lag을 가지고 master랑 sync가 된다.
  - DB트랜잭션 안에서는 온체인 트랜잭션을 날리면 안된다. (예외: lock을 잡지 않을때면 가능) 최대한 lock을 짧게 가져가야 한다.
  - pessimistic_write는 굉장히 강력한 lock이다. lock이 걸린 데이터에 대해 읽을수도 없다.
    - 이건 select for update를 할 경우에만 해야 한다.
  - eager relation
    - 관계된 테이블을 무조건 로딩한다. 즉 join한다.
    - 문제는 join된 테이블에도 lock을 걸게되는것이다. 만약 유저 개인별 데이터가 공통 데이터와 관계되어 있다면, 여기다가 무턱대고 lock을 걸어버리면 바로 데드락 나는것이다.
  - Summary
    - select for update면 pessimistic write lock이다.
    - lock의 범위를 생각하자.
    - 특히 join 되면 같이 락이 걸리는것임을 유념하자. relation 관련 lock에는 조심해야 한다.

- code4arena contest
  - 가입만 해두고 안봤는데 직접 해보려고 보니까 말 그대로 야생이라는 생각이 든다.
  - 보안이슈 잡기는 커녕 이 거대한 코드베이스를 이해하기에도 벅차다는 느낌.
  - 내가 관심있는 프로젝트나 컨테스트로 올라온 코드베이스는 한번 코드리딩을 각 잡고 해보면 어떨까.
  - 어딧말고 그냥 내 개발력 향상에도 도움이 될 것 같다.
- RACE-13 오답노트
  - Inline assembly 이해가 어렵다. string에 대한 abi encoding이 어떻게 이뤄지는지, 0x20단위가 아니라 0x28과 같은 주소에 mstore를 하면 어떻게 되는건지 이해가 잘안된다.
  - 내일 다시 살펴보자.
- 저녁 컨디션이 그렇게 좋지는 않다. 집중도 잘 안되고 아무것도 하기가 싫은 기분이 든다.
  - 근데 또 TIL 정리하면서 조금 힘이 난다.

### Wed, Jan 18

- 확장성 있게 코드를 짠다는건 뭘까? 코드를 잘 짠다는건 뭘까? 작업하면서 내가 작성하고 있는 코드가 잘 짜여진것인지 확신이 안든다. 구조를 어떻게 하면 잘 잡을 수 있을까?
  - TODO: 이에 대해 구글링을 해보거나 chatGPT에 물어보자.
- pagerDuty 사용하는 방법을 배우고 적용해봤다.
  - 어카운트 밸런스가 떨어졌을 때 alert를 중복없이 주는것까지 성공했다.
  - 내일은 밸런스 회복시 resolve 까지 구현해보자.
- 사이드 프로젝트
  - 대충 컨텐츠 등록과 출금 기능까지 구현했다.
  - 어떻게 하면 효율적으로 컨텐츠를 저장하고 열람할 수 있을까 고민하다가 결국 mapping과 array를 적절하게 섞어서 쓰는 방법을 선택했다. EnumerableSet 같은 느낌으로.
- RACE 13 오답노트
  - 드디어 mstore와 return에 대해서 어느정도 이해했다.
  - 그리고 string이 memory에 저장되는 방식도 이해했다. 먼저 length가 오고 그 다음 string content가 온다.
  - 내일은 string의 abi encoding에 대한 것을 학습해보면 좋을것 같다.

### Thu, Jan 19

- 오늘은 이슈 대응하는데 거의 모든 시간을 썼다.

  - 두가지 이슈를 대응했다. 엄밀히 말하면 하나는 대응이 끝났고, 하나는 원인 파악을 아직 제대로 하지 못했다.
  - 첫번째는 API 오퍼레이터 어카운트 gas 부족으로 인해 API server에서 전송하는 트랜잭션이 모두 실패했다.
    - 다행히 오전에 너무 늦게 알아차리지는 않아서 약 2시간 동안 tx가 전송되지 않았던것을 빼면 큰 이슈가 없었다.
    - 이로 인해 영향받는 케이스들을 다 정리하고 하나씩 해결했다.
    - 근데 여기서 해결하는데도 실수가 하나 있었다. 누락된 것들을 잘못 지급했다. 아주 치명적이지는 않지만 그래도 실수였다. 덕분에 앞으로는 실수를 안하게 될 것 같다.
  - 두번째 이슈는 아직 원인 파악이 안됐다.
    - 저녁 시간 내내 계속 파악을 해보려 애썼는데 결국 못했다. 매우 답답하다.

- 오퍼레이터 어카운트 alert 기능을 모두 구현했다.
  - 다시 밸런스 회복시 자동으로 resolve 되는것까지 잘 구현했다.
  - 이제 리뷰 진행하고 조금 더 구조를 개선하면 완성이다. 잘했다.
